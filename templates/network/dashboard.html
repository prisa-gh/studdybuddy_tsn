{% extends "base.html" %}
{% load network_extras %}


{% block content %}
  <meta charset="UTF-8">

  <h2>Welcome, {{ user_profile.user.username }}!</h2>

  {% if messages %}
    {% for message in messages %}
      <p style="color: {% if message.tags == 'success' %}green{% else %}red{% endif %};">
        {{ message }}
      </p>
    {% endfor %}
  {% endif %}

  <h3>Suggested Study Buddies</h3>

  <ul>
    {% for suggestion in suggestions %}
        {% with profile=suggestion.profile slots=suggestion.slots weekdays=suggestion.weekdays %}
          <li>
            <strong>{{ profile.user.username }}</strong> ‚Äî {{ profile.major }}<br>
            <img src="{{ profile.profile_pic_url }}" alt="Profile Picture" width="60" height="60" style="object-fit:cover; border-radius:30px;">
            Courses: {{ profile.courses.all|join:", " }}<br>
            Study Style: {{ profile.get_study_style_display }}<br>
    
            <form action="{% url 'send_invite' profile.id %}" method="post">
              {% csrf_token %}
                <div>
                    <span>{{ suggestion.profile.user.username }}</span>
                    {% if suggestion.slots %}
                      {% with slot=suggestion.slots.0 %}
                        <form method="post" action="{% url 'send_invite' suggestion.profile.id %}">
                          {% csrf_token %}
                          <input type="hidden" name="start" value="{{ slot.1|date:'Y-m-d H:i' }}">
                          <input type="hidden" name="end" value="{{ slot.2|date:'Y-m-d H:i' }}">
                          <button type="submit">Send Invite for {{ slot.1|date:"D, M d H:i" }}‚Äì{{ slot.2|date:"H:i" }}</button>
                        </form>
                      {% endwith %}
                    {% endif %}
                </div>
    
              <button type="submit">Send Invite</button>
            </form>
          </li>
        {% endwith %}
    {% empty %}
      <li>No suitable study buddies found at the moment.</li>
    {% endfor %}
  </ul>
    
    <h3>üì® Pending Study Invites</h3>
    
    <ul>
      {% for invite in incoming_invites %}
        <li>
          <strong>{{ invite.sender.user.username }}</strong> invites you to study on
          {{ invite.selected_start }} to {{ invite.selected_end }}.
    
          <a href="{% url 'accept_invite' invite.id %}">‚úÖ Accept</a> |
          <a href="{% url 'reject_invite' invite.id %}">‚ùå Reject</a>
        </li>
      {% empty %}
        <li>No new invites</li>
      {% endfor %}
    </ul>
{% endblock %}