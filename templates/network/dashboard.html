{% extends "base.html" %}
{% load network_extras %}




{% block content %}
  <meta charset="UTF-8">

  <h2>Welcome, {{ user_profile.user.username }}!</h2>

  {% if messages %}
    {% for message in messages %}
      <p style="color: {% if message.tags == 'success' %}green{% else %}red{% endif %};">
        {{ message }}
      </p>
    {% endfor %}
  {% endif %}

  <h3>Suggested Study Buddies</h3>
    <p style="color: #666; font-size: 0.95em;">
    These are students who share courses, study styles, and availability with you.
    </p>

  <div class="suggestions-list">
        {% for suggestion in suggestions %}
            {% with profile=suggestion.profile %}
            <div class="buddy-card">
                <img class="buddy-img" src="{{ profile.profile_pic_url }}" alt="{{ profile.user.username }}'s pic">
                <div class="buddy-info">
                    <strong>{{ profile.user.username }}</strong>
                    <span class="badge major">{{ profile.major }}</span>
                    <span class="study-style">üìù {{ profile.get_study_style_display }}</span>
                    <div class="details">
                        <span>Year: {{ profile.get_year_of_study_display }}</span>
                        <span>School: {{ profile.school }}</span>
                    </div>
                    <div class="shared-section">
                        <span class="shared-title">Shared Courses:</span>
                        <ul class="shared-courses">
                            {% for course in suggestion.shared_courses %}
                            <li>{{ course.code }}: {{ course.name }}</li>
                            {% empty %}
                            <li><em>None</em></li>
                            {% endfor %}
                        </ul>
                        <span class="shared-title">Shared Days:</span>
                        <div class="shared-days">
                            {% for day in suggestion.shared_days %}
                              <span class="weekday">{{ day|capfirst }}</span>
                            {% empty %}
                              <em>None</em>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="actions">
                    <form method="post" action="{% url 'send_invite' profile.id %}">
                        {% csrf_token %}
                        <button type="submit" class="invite-btn">Send Invite</button>
                    </form>
                </div>
            </div>
            {% endwith %}
        {% empty %}
            <p>No suggestions at this time.</p>
        {% endfor %}
    </div>


    <h3>üì® Pending Study Invites</h3>

    <ul>
      {% for invite in incoming_invites %}
        <li>
          <strong>{{ invite.sender.user.username }}</strong> invites you to study on
          {{ invite.selected_start }} to {{ invite.selected_end }}.

          <a href="{% url 'accept_invite' invite.id %}">‚úÖ Accept</a> |
          <a href="{% url 'reject_invite' invite.id %}">‚ùå Reject</a>
        </li>
      {% empty %}
        <li>No new invites</li>
      {% endfor %}
    </ul>
<h3>üë• FOAF Study Buddy Recommendations</h3>
<p style="color: #666; font-size: 0.95em;">
    These are students connected to your current study buddies, but not yet connected to you.
</p>

<ul class="foaf-container">
  {% for foaf in foaf_suggestions %}
    <li class="foaf-card">
      <img class="foaf-image" src="{{ foaf.profile_pic_url }}" alt="Profile Picture">
      <div class="foaf-info">
        <div class="foaf-header">{{ foaf.user }} {{ foaf.id }}</div>
        <div class="foaf-details">{{ foaf.major }}</div>
        <div class="foaf-details"><strong>Courses in common:</strong> {{ foaf.common_courses|join:", " }}</div>
        <div class="foaf-details">
          <strong>Shared Days:</strong>
          {% if foaf.shared_days %}
              {{ foaf.shared_days|join:", " }}
          {% else %}
              <span style="color: #888;">None</span>
          {% endif %}
        </div>
        <div class="foaf-details"><strong>Friend of:</strong> {{ foaf.buddy_names|join:", " }}</div>

        {% if foaf.id %}
          <form action="{% url 'send_invite' foaf.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="foaf-invite-btn">Send Invite</button>
          </form>
        {% else %}
          <span style="color: red;">Cannot invite (invalid profile)</span>
        {% endif %}
      </div>
    </li>
  {% empty %}
    <li>No ‚Äúfriend-of-friend‚Äù recommendations found at the moment.</li>
  {% endfor %}
</ul>
{% endblock %}