{% extends "base.html" %}

{% block content %}
<div style="max-width:900px; margin:35px auto 0; background:#fff; border-radius:12px; box-shadow:0 8px 28px #0066cc0d; padding:32px 3vw 38px 3vw;">
    <h2 style="font-weight:700; color:#007bff; margin-bottom:1.3em;">&#128172; Direct Messages</h2>
    <div style="display: flex; gap: 32px; align-items: flex-start;">
      <!-- Left: Chat buddy selector -->
      <div style="min-width:170px;">
        <div style="font-size:1em; font-weight:500; margin-bottom:.7em; color:#495057;">Your Buddies</div>
        <ul style="list-style:none; padding:0;">
          {% for chat in chats %}
            <li style="margin-bottom:.5em;">
              <span style="display:flex; align-items:center;">
                <span style="width:11px; height:11px; background:#007bff77; border-radius:50%; margin-right:8px;"></span>
                <strong style="color:#222;">{{ chat.buddy.user.username }}</strong>
              </span>
            </li>
          {% endfor %}
        </ul>
      </div>
      <!-- Right: Conversations -->
      <div style="flex:1;">
        {% for chat in chats %}
          <div style="margin-bottom: 2.4em; border-radius:8px; border:1px solid #e3eaf1; background:#f9fbfd;">
            <div style="padding:16px 18px 8px 18px; border-bottom:1px solid #eaecee;">
              <h3 style="margin:0 0 .2em 0; color:#339;">Chat with <span style="font-weight:600;">{{ chat.buddy.user.username }}</span></h3>
            </div>
            <div style="max-height:220px; overflow-y:auto; padding: 18px 18px 10px 18px;">
              {% for msg in chat.conversation %}
                <div style="margin-bottom:10px; display:flex; align-items:flex-end;">
                  <div style="flex:1;">
                    <div
                      style="
                        display:inline-block; 
                        background: {% if msg.sender == user_profile %}#e9f8ee{% else %}#fff{% endif %};
                        color:#235; border-radius:12px; padding:7px 15px; min-width:60px;
                        box-shadow:0 1.5px 6px #0066cc0a;">
                      <b style="color:#007bff;">{{ msg.sender.user.username }}</b>:
                      <span style="font-size:.97em;">{{ msg.message|linebreaksbr }}</span>
                    </div>
                    <div style="font-size:.86em; color:#888; margin-top:2px; margin-left:4px;">
                      {{ msg.timestamp|date:"M d, H:i" }}
                    </div>
                  </div>
                </div>
              {% empty %}
                <em style="color:#aaa;">No messages yet.</em>
              {% endfor %}
            </div>
            <form method="post" style="border-top:1px solid #eaecee; padding:13px 18px 5px 18px;">
              {% csrf_token %}
              <input type="hidden" name="buddy_id" value="{{ chat.buddy.id }}">
              <div style="display:flex; align-items:flex-end; gap:8px;">
                {{ chat.form.message}}
                <button type="submit" style="background:#007bff; color:#fff; padding:7px 19px; border-radius:6px; border:none; font-weight:600; font-size:1em; transition:box-shadow .15s;">
                  Send
                </button>
              </div>
            </form>
          </div>
        {% endfor %}
      </div>
    </div>
</div>
{% endblock %}